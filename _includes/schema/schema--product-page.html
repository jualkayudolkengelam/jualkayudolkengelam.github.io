{% comment %}
============================================================================
Combined Schema: Product Page (WebPage + Product)
============================================================================

@file        schema--product-page.html
@path        _includes/schema--product-page.html
@type        Schema (combined component)
@description Combined schema for product pages in single @graph
@author      arisciwek

This include combines WebPage and Product schemas into a single @graph
for better Google Rich Results recognition.

Note: BreadcrumbList schema is now handled separately in block--breadcrumb.html
for better reusability across different page types.

Parameters:
-----------
- product: (required) product object (usually page)

Usage:
------
In node--product.html:
{% include schema/schema--product-page.html product=page %}

Benefits:
---------
- WebPage + Product schemas in single @graph (Google best practice)
- Better Rich Results detection
- Single source of truth for product page schema
- Breadcrumb schema separated for reusability (block--breadcrumb.html)
- Maintains separation of concerns (only used for product pages)

============================================================================
{% endcomment %}

{% assign product = include.product %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "@id": "{{ product.url | absolute_url }}#webpage",
      "url": "{{ product.url | absolute_url }}",
      "name": "{{ product.title }}",
      "description": "{{ product.description | strip_html | strip_newlines | escape }}",
      "inLanguage": "{{ site.lang | default: 'id' }}",
      "isPartOf": {
        "@type": "WebSite",
        "@id": "{{ site.url }}{{ site.baseurl }}/#website",
        "url": "{{ site.url }}{{ site.baseurl }}/",
        "name": "{{ site.title }}"
      }{% if product.image %},
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "{{ product.image | absolute_url }}"
      }{% endif %}{% if product.date %},
      "datePublished": "{{ product.date | date_to_xmlschema }}",
      "dateModified": "{% if product.last_modified_at %}{{ product.last_modified_at | date_to_xmlschema }}{% else %}{{ product.date | date_to_xmlschema }}{% endif %}"{% endif %}
    },
    {
      "@type": "Product",
      "@id": "{{ product.url | absolute_url }}#product",
      "name": "{{ product.title }}",
      "description": "{{ product.description | strip_html | strip_newlines | escape }}",
      "image": "{{ product.image | absolute_url }}",
      "url": "{{ product.url | absolute_url }}",
      "sku": "{{ product.sku }}",
      "brand": {
        "@type": "Brand",
        "name": "{{ site.business.name }}"
      },
      "category": "{{ product.category | default: 'Kayu Dolken Gelam' }}",
      "material": "{{ product.material | default: 'Kayu Gelam' }}",
      "offers": {
        "@type": "Offer",
        "price": "{{ product.price }}",
        "priceCurrency": "IDR",
        "priceSpecification": {
          "@type": "PriceSpecification",
          "price": "{{ product.price }}",
          "priceCurrency": "IDR",
          "valueAddedTaxIncluded": false
        },
        "availability": "https://schema.org/InStock",
        "url": "{{ product.url | absolute_url }}",
        "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
        "seller": {
          "@type": "Organization",
          "name": "{{ site.business.name }}"
        },
        "shippingDetails": {
          "@type": "OfferShippingDetails",
          "shippingRate": {
            "@type": "MonetaryAmount",
            "value": "0",
            "currency": "IDR"
          },
          "shippingDestination": {
            "@type": "DefinedRegion",
            "addressCountry": "ID"
          },
          "deliveryTime": {
            "@type": "ShippingDeliveryTime",
            "handlingTime": {
              "@type": "QuantitativeValue",
              "minValue": 1,
              "maxValue": 2,
              "unitCode": "DAY"
            },
            "transitTime": {
              "@type": "QuantitativeValue",
              "minValue": 3,
              "maxValue": 7,
              "unitCode": "DAY"
            }
          }
        },
        "hasMerchantReturnPolicy": {
          "@type": "MerchantReturnPolicy",
          "applicableCountry": "ID",
          "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
          "merchantReturnDays": 7,
          "returnMethod": "https://schema.org/ReturnByMail",
          "returnFees": "https://schema.org/FreeReturn"
        }
      }{% if product.rating or product.review_count %},
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "{{ product.rating | default: 4.5 }}",
        "reviewCount": "{{ product.review_count | default: 45 }}",
        "bestRating": "5",
        "worstRating": "1"
      }{% endif %}{% if product.diameter %},
      "additionalProperty": [
        {
          "@type": "PropertyValue",
          "name": "Diameter",
          "value": "{{ product.diameter }}"
        },
        {
          "@type": "PropertyValue",
          "name": "Panjang",
          "value": "4 Meter"
        }
      ]{% endif %}
    }
  ]
}
</script>
