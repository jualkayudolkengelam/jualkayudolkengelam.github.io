{% comment %}
  ============================================================================
  Schema Include - Front Page (@graph with WebPage, Breadcrumb, ProductGroup)
  ============================================================================

  @file        _includes/schema--front.html
  @description Front page (homepage) schema with @graph combining WebPage,
               BreadcrumbList, and ProductGroup for better SEO.

  @version     2.0.0
  @date        2025-12-15
  @author      jualkayudolkengelam
  @copyright   2024-2025 Kayu Dolken Gelam - Amirudin Abdul Karim
  @license     All rights reserved

  Features:
  ---------
  - @graph structure combining multiple schema types
  - WebPage schema with page info
  - BreadcrumbList for homepage (single level)
  - ProductGroup with all product variants (grouped by diameter size)

  Called from:
  ------------
  - page--front.html layout (via custom_schema frontmatter)
  - Only for front page (index.html)

  ============================================================================
{% endcomment %}

<!-- Schema.org Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "@id": "{{ page.url | absolute_url }}#webpage",
      "url": "{{ page.url | absolute_url }}",
      "name": "{{ page.title }}",
      "description": "{{ page.description }}",
      "inLanguage": "{{ site.lang | default: 'id' }}",
      "isPartOf": {
        "@type": "WebSite",
        "@id": "{{ site.url }}{{ site.baseurl }}/#website",
        "url": "{{ site.url }}{{ site.baseurl }}/",
        "name": "{{ site.title }}"
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Beranda",
          "item": "{{ site.url }}{{ site.baseurl }}/"
        }
      ]
    },
    {
      "@type": "ProductGroup",
      "@id": "{{ site.url }}{{ site.baseurl }}/#product-group",
      "name": "Kayu Dolken Gelam Panjang 4 Meter",
      "description": "Kayu dolken gelam berkualitas tinggi dengan berbagai ukuran diameter. Cocok untuk konstruksi, pagar, dan dekorasi.",
      "url": "{{ site.url }}{{ site.baseurl }}/product",
      "image": "{{ site.url }}{{ site.baseurl }}/assets/images/products/jual-kayu-dolken-gelam-8-10cm-001.jpeg",
      "brand": {
        "@type": "Brand",
        "name": "Kayu Dolken Gelam"
      },
      "productGroupID": "kayu-dolken-gelam-4m",
      "variesBy": "https://schema.org/size",
      {% assign total_rating = 0 %}
      {% assign total_reviews = 0 %}
      {% for product in site.products %}
        {% assign product_rating = product.rating | default: 4.5 | times: 1.0 %}
        {% assign product_reviews = product.review_count | default: 45 %}
        {% assign weighted = product_rating | times: product_reviews %}
        {% assign total_rating = total_rating | plus: weighted %}
        {% assign total_reviews = total_reviews | plus: product_reviews %}
      {% endfor %}
      {% assign avg_rating = total_rating | divided_by: total_reviews | round: 1 %}
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "{{ avg_rating }}",
        "reviewCount": "{{ total_reviews }}",
        "bestRating": "5",
        "worstRating": "1"
      },
      {% if page.reviews %}
      "review": [
        {% assign front_reviews = page.reviews | slice: 0, 3 %}
        {% for review in front_reviews %}
        {
          "@type": "Review",
          "author": {
            "@type": "Person",
            "name": "{{ review.author }}"
          },
          "datePublished": "{{ review.date }}",
          "reviewBody": "{{ review.comment | escape }}",
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "{{ review.rating }}",
            "bestRating": "5",
            "worstRating": "1"
          }
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      {% endif %}
      "hasVariant": [
        {% assign sorted_products = site.products | sort: "price" %}
        {% for product in sorted_products %}
        {
          "@type": "Product",
          "@id": "{{ product.url | absolute_url }}#product",
          "name": "{{ product.title }}",
          "description": "{{ product.description }}",
          "url": "{{ product.url | absolute_url }}",
          {% if product.image %}
          "image": "{{ product.image | absolute_url }}",
          {% endif %}
          "sku": "{{ product.sku }}",
          "size": "{{ product.diameter }}",
          "offers": {
            "@type": "Offer",
            "url": "{{ product.url | absolute_url }}",
            "priceCurrency": "IDR",
            "price": "{{ product.price }}",
            "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
            "availability": "https://schema.org/InStock",
            "seller": {
              "@id": "{{ site.url }}{{ site.baseurl }}/#organization"
            },
            "shippingDetails": {
              "@type": "OfferShippingDetails",
              "shippingRate": {
                "@type": "MonetaryAmount",
                "value": "0",
                "currency": "IDR"
              },
              "shippingDestination": {
                "@type": "DefinedRegion",
                "addressCountry": "ID"
              },
              "deliveryTime": {
                "@type": "ShippingDeliveryTime",
                "handlingTime": {
                  "@type": "QuantitativeValue",
                  "minValue": 1,
                  "maxValue": 2,
                  "unitCode": "DAY"
                },
                "transitTime": {
                  "@type": "QuantitativeValue",
                  "minValue": 3,
                  "maxValue": 7,
                  "unitCode": "DAY"
                }
              }
            },
            "hasMerchantReturnPolicy": {
              "@type": "MerchantReturnPolicy",
              "applicableCountry": "ID",
              "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
              "merchantReturnDays": 7,
              "returnMethod": "https://schema.org/ReturnByMail",
              "returnFees": "https://schema.org/FreeReturn"
            }
          }
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    }
  ]
}
</script>
