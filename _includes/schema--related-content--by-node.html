{% comment %}
  ============================================================================
  Schema Include - Related Content by Node (ItemList with BlogPosting)
  ============================================================================

  @file        _includes/schema--related-content--by-node.html
  @description Dedicated schema include for related articles ItemList markup.
               Separated from block--related-content--by-node.html for better
               architecture and schema centralization at page wrapper level.

  @version     1.0.0
  @date        2025-11-21
  @author      jualkayudolkengelam
  @copyright   2024-2025 Kayu Dolken Gelam - Amirudin Abdul Karim
  @license     All rights reserved

  Architecture:
  -------------
  - Block (_includes/block--related-content--by-node.html): Visual rendering
  - Schema (_includes/schema--related-content--by-node.html): Schema markup
  - Page wrapper (_layouts/page--post.html): Include schema before </body>

  Features:
  ---------
  - Schema.org ItemList with BlogPosting items
  - Complete BlogPosting metadata (headline, url, image, dates)
  - Author (Person) and Publisher (Organization) entities
  - interactionStatistic for engagement (likes, comments, shares)
  - Perfect schema/visual accuracy (numberOfItems matches display)

  Parameters:
  -----------
  - posts: Array of post objects (required)
  - title: Section title for schema name (default: "Artikel Terkait Lainnya")

  Usage:
  ------
  {% include schema--related-content--by-node.html posts=final_posts %}

  {% include schema--related-content--by-node.html posts=final_posts title="Artikel Panduan & Tips" %}

  Called from:
  ------------
  - _layouts/page--post.html (before </body> tag)
  - Any page wrapper needing related content schema

  ============================================================================
{% endcomment %}

{% assign schema_posts = include.posts %}
{% assign schema_title = include.title | default: "Artikel Terkait Lainnya" %}

{% if schema_posts and schema_posts.size > 0 %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "@id": "{{ page.url | absolute_url }}#related-articles-by-node",
  "name": "{{ schema_title }}",
  "description": "Artikel blog terkait yang mungkin Anda minati",
  "numberOfItems": {{ schema_posts.size }},
  "itemListElement": [
    {% for post in schema_posts %}
    {
      "@type": "ListItem",
      "position": {{ forloop.index }},
      "name": "{{ post.title }}",
      "item": {
        "@type": "BlogPosting",
        "headline": "{{ post.title }}",
        "url": "{{ post.url | absolute_url }}",
        {% if post.images %}
        "image": "{{ post.images[0] | absolute_url }}",
        {% elsif post.image %}
        "image": "{{ post.image | absolute_url }}",
        {% endif %}
        "datePublished": "{{ post.date | date_to_xmlschema }}",
        {% if post.last_modified_at %}
        "dateModified": "{{ post.last_modified_at | date_to_xmlschema }}",
        {% endif %}
        "author": {
          "@type": "Person",
          "name": "{% if post.author %}{{ post.author }}{% else %}Admin{% endif %}"{% if post.author_url %},
          "url": "{{ post.author_url }}"{% endif %}
        },
        "publisher": {
          "@type": "Organization",
          "name": "{{ site.business.name }}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{ '/assets/images/jual-kayu-dolken-gelam-lokalbisnis-001.jpeg' | absolute_url }}"
          }
        }{% if post.like_count or post.comment_count or post.share_count %},
        "interactionStatistic": [
          {% if post.like_count %}
          {
            "@type": "InteractionCounter",
            "interactionType": "https://schema.org/LikeAction",
            "userInteractionCount": {{ post.like_count }}
          }{% if post.comment_count or post.share_count %},{% endif %}
          {% endif %}
          {% if post.comment_count %}
          {
            "@type": "InteractionCounter",
            "interactionType": "https://schema.org/CommentAction",
            "userInteractionCount": {{ post.comment_count }}
          }{% if post.share_count %},{% endif %}
          {% endif %}
          {% if post.share_count %}
          {
            "@type": "InteractionCounter",
            "interactionType": "https://schema.org/ShareAction",
            "userInteractionCount": {{ post.share_count }}
          }
          {% endif %}
        ]{% endif %}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}
