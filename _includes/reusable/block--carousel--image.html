{% comment %}
  ============================================================================
  Image Carousel Component (Visual Only)
  ============================================================================

  @file        _includes/block--carousel--image.html
  @description Reusable Bootstrap 5 carousel component (visual rendering only).
               Displays multiple images in sliding gallery format with indicators,
               controls, and WebP optimization.

  @version     1.1.0
  @date        2025-11-21
  @author      jualkayudolkengelam
  @copyright   2024-2025 Kayu Dolken Gelam - Amirudin Abdul Karim
  @license     All rights reserved

  Changelog:
  ----------
  v1.1.0 (2025-11-21)
    - Extract ImageGallery schema to dedicated include (schema--carousel--image.html)
    - Component now focuses on visual rendering only
    - Schema centralized at page wrapper level for better architecture

  v1.0.3 (2025-11-16)
    - Added "representativeOfPage": false to each ImageObject

  v1.0.2 (2025-11-16)
    - Use Schema.org standard structure for ImageGallery

  v1.0.1 (2025-11-16)
    - Initial component with ImageGallery schema

  Features:
  ---------
  - Bootstrap 5 carousel with slide animation
  - WebP optimization with picture element
  - Lazy loading (except first image)
  - Responsive design with object-fit: cover
  - Carousel indicators for navigation
  - Previous/Next controls
  - Customizable carousel ID and max height

  Schema:
  -------
  Schema for this block is now in: _includes/schema--carousel--image.html
  Call from page wrapper with: {% include schema--carousel--image.html images=page.images title=page.title %}

  Parameters:
  -----------
  - carousel_id: Unique ID for carousel element (default: "imageCarousel")
  - images: Array of image paths (required)
  - images_alt: Array of alt text for each image (optional, uses title if not provided)
  - title: Page/product title for alt text (required)
  - max_height: Max height for images (default: "500px")
  - gallery_name: Gallery name for schema (default: uses title)
  - description: Optional description for images

  Usage:
  ------
  {% include reusable/block--carousel--image.html
     carousel_id="productCarousel"
     images=page.images
     title=page.title
     gallery_name="Galeri Produk Kayu Dolken"
  %}

  {% include reusable/block--carousel--image.html
     carousel_id="postCarousel"
     images=page.images
     title=page.title
     max_height="600px"
  %}

  Used in:
  --------
  - _layouts/product.html (product image galleries)
  - _layouts/post.html (blog post image galleries)
  - _layouts/post-with-products.html (article image galleries)

  ============================================================================
{% endcomment %}

{% assign carousel_id = include.carousel_id | default: "imageCarousel" %}
{% assign carousel_images = include.images %}
{% assign carousel_images_alt = include.images_alt %}
{% assign carousel_title = include.title %}
{% assign max_height = include.max_height | default: "500px" %}
{% assign gallery_name = include.gallery_name | default: carousel_title %}
{% assign carousel_description = include.description | default: "" %}

{% if carousel_images and carousel_images.size > 0 %}

{% comment %}
Schema for this block is now in: _includes/schema--carousel--image.html
Call from page wrapper with: {% include schema--carousel--image.html images=page.images title=page.title %}
{% endcomment %}

<!-- Image Gallery Carousel -->
<div id="{{ carousel_id }}" class="carousel slide shadow rounded" data-bs-ride="carousel">
  <div class="carousel-indicators">
    {% for image in carousel_images %}
    <button type="button" data-bs-target="#{{ carousel_id }}" data-bs-slide-to="{{ forloop.index0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %} aria-label="Slide {{ forloop.index }}"></button>
    {% endfor %}
  </div>
  <div class="carousel-inner">
    {% for image in carousel_images %}
    {% assign img_index = forloop.index0 %}
    {% if carousel_images_alt and carousel_images_alt[img_index] %}
      {% assign img_alt = carousel_images_alt[img_index] %}
    {% else %}
      {% assign img_alt = carousel_title | append: " - Foto " | append: forloop.index %}
    {% endif %}
    <div class="carousel-item {% if forloop.first %}active{% endif %}">
      <picture>
        <source srcset="{{ image | replace: '.jpeg', '.webp' | relative_url }}" type="image/webp">
        <img src="{{ image | relative_url }}"
             class="d-block w-100 rounded"
             alt="{{ img_alt }}"
             loading="eager"
             style="max-height: {{ max_height }}; object-fit: cover;">
      </picture>
    </div>
    {% endfor %}
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#{{ carousel_id }}" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#{{ carousel_id }}" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

{% endif %}
